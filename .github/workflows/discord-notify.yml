name: Discord Notifications

on:
  push:
    branches: [ main, develop ]
  pull_request:
    types: [ opened, closed ]
  workflow_run:
    workflows: ["React CI"]
    types: [ completed ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify on push
        if: github.event_name == 'push'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "üì¶ New push to ${{ github.ref_name }}"
          description: |
            **Commit:** ${{ github.event.head_commit.message }}
            **Author:** ${{ github.event.head_commit.author.name }}
          color: 0x0099ff
          username: Savory Frontend Bot
      
      - name: Notify on PR opened
        if: github.event_name == 'pull_request' && github.event.action == 'opened'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "üîÄ New PR opened"
          description: |
            **PR:** ${{ github.event.pull_request.title }}
            **Author:** ${{ github.event.pull_request.user.login }}
            **Link:** ${{ github.event.pull_request.html_url }}
          color: 0xffa500
          username: Savory Frontend Bot
      
      - name: Notify on PR merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "‚úÖ PR merged to ${{ github.event.pull_request.base.ref }}"
          description: |
            **PR:** ${{ github.event.pull_request.title }}
            **Author:** ${{ github.event.pull_request.user.login }}
          color: 0x00ff00
          username: Savory Frontend Bot
      
      - name: Notify on CI completion
        if: github.event_name == 'workflow_run'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          title: "${{ github.event.workflow_run.conclusion == 'success' && '‚úÖ CI Passed' || '‚ùå CI Failed' }}"
          description: |
            **Workflow:** ${{ github.event.workflow_run.name }}
            **Branch:** ${{ github.event.workflow_run.head_branch }}
            **Status:** ${{ github.event.workflow_run.conclusion }}
          color: ${{ github.event.workflow_run.conclusion == 'success' && '0x00ff00' || '0xff0000' }}
          username: Savory Frontend Bot
